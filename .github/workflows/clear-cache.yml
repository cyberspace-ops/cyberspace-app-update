name: Clear Cache Every 6 Hours

on:
  schedule:
    - cron: '0 */6 * * *' # runs 00:00, 06:00, 12:00, 18:00 UTC
  workflow_dispatch: # allow manual run

jobs:
  hit-endpoint:
    runs-on: ubuntu-latest
    steps:
      - name: Ping /clear-cache (flush all)
        run: |
          # Send an empty JSON body {} because your handler calls request.json()
          # and will throw if there is no body.
          curl --fail --silent --show-error \
            --retry 3 --retry-all-errors \
            -X POST "$CLEAR_CACHE_URL" \
            -H "Content-Type: application/json" \
            -H "x-revalidate-key: $REVALIDATE_SECRET_TOKEN" \
            --data '{}'
        env:
          CLEAR_CACHE_URL: https://www.cyberspacestore.id/api/clear-cache
          REVALIDATE_SECRET_TOKEN: ${{ secrets.REVALIDATE_SECRET_TOKEN }}
